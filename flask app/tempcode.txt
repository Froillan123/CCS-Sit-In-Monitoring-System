<div id="profile" class="dashboard-section" style="display: none;">
      <div class="profile-container">
        <div class="profile-card">
          <!-- Profile Picture -->
          <div class="profile-header">
            <div class="profile-picture" onclick="document.getElementById('profile-picture-upload').click()">
              <img id="profile-picture" src="{{ url_for('static', filename='images/' + student.profile_picture if student.profile_picture else 'default.png') }}" alt="Profile Picture" />
              <input type="file" id="profile-picture-upload" style="display: none;" />
              <div class="edit-overlay"><i class="fas fa-camera"></i></div>
            </div>
          </div>
          <!-- Student Details -->
          <div class="profile-details">
            <div class="detail-item">
              <label for="editable-idno"><i class="fas fa-id-card"></i> ID Number:</label>
              <input type="text" id="editable-idno" value="{{ student.idno }}" readonly />
            </div>
            <div class="detail-row">
              <div class="detail-item">
                <label for="editable-firstname"><i class="fas fa-user"></i> First Name:</label>
                <input type="text" id="editable-firstname" value="{{ student.firstname }}" />
              </div>
              <div class="detail-item">
                <label for="editable-lastname"><i class="fas fa-user"></i> Last Name:</label>
                <input type="text" id="editable-lastname" value="{{ student.lastname }}" />
              </div>
            </div>
            <div class="detail-row">
              <div class="detail-item">
                <label for="editable-midname"><i class="fas fa-user"></i> Middle Name:</label>
                <input type="text" id="editable-midname" value="{{ student.midname }}" />
              </div>
              <div class="detail-item">
                <label for="course"><i class="fas fa-graduation-cap"></i> Course:</label>
                <select id="editable-course" name="course" required>
                    <option value="" disabled selected>{{ student.course }}</option>
                    <option value="BSIT">BSIT - Bachelor of Science in Information Technology</option>
                    <option value="BSCpE">BSCpE - Bachelor of Science in Computer Engineering</option>
                    <option value="BSBA">BSBA - Bachelor of Science in Business Administration</option>
                    <option value="BSCS">BSCS - Bachelor of Science in Computer Science</option>
                    <option value="BSEd">BSEd - Bachelor of Science in Education</option>
                    <option value="BSHRM">BSHRM - Bachelor of Science in Hotel & Restaurant Management</option>
                    <option value="BSN">BSN - Bachelor of Science in Nursing</option>
                    <option value="BSEd">BSEd - Bachelor of Secondary Education</option>
                    <option value="BEEd">BEEd - Bachelor of Elementary Education</option>
                    <option value="BCE">BCE - Bachelor of Civil Engineering</option>
                    <option value="BME">BME - Bachelor of Mechanical Engineering</option>
                    <option value="BEE">BEE - Bachelor of Electrical Engineering</option>
                    <option value="BIE">BIE - Bachelor of Industrial Engineering</option>
                    <option value="BNAME">BNAME - Bachelor of Naval Architecture & Marine Engineering</option>
                    <option value="BCrim">BCrim - Bachelor of Criminology</option>
                    <option value="BCom">BCom - Bachelor of Commerce</option>
                    <option value="BAcc">BAcc - Bachelor of Accountancy</option>
                    <option value="BCSA">BCSA - Bachelor of Customs Administration</option>
                    <option value="BCSec">BCSec - Bachelor of Computer Secretarial</option>
                    <option value="BIP">BIP - Bachelor of Industrial Psychology</option>
                    <option value="ABPS">ABPS - AB in Political Science</option>
                    <option value="ABEng">ABEng - AB in English</option>
                    <option value="CISCO">CISCO - CISCO Networking Academy (Module 1 - 4)</option>
                    <option value="ESL">ESL - English as a Second Language Course</option>
                    <option value="CKor">CKor - Conversational Korean</option>
                    <option value="ESLF">ESLF - ESL Course (for Foreign Students)</option>  
                </select>
            </div>
            
            <div class="detail-item">
                <label for="year_level"><i class="fas fa-calendar-alt"></i> Year Level:</label>
                <select id="editable-year-level" name="year_level" required>
                    <option value="" disabled selected>{{ student.year_level }}</option>
                    <option value="1">1st Year</option>
                    <option value="2">2nd Year</option>
                    <option value="3">3rd Year</option>
                    <option value="4">4th Year</option>
                </select>
            </div>
            
              <div class="detail-item">
                <label for="editable-email"><i class="fas fa-envelope"></i> Email:</label>
                <input type="email" id="editable-email" value="{{ student.email }}" />
              </div>
            </div>
            <div class="detail-row">
              <div class="detail-item">
                <label for="editable-username"><i class="fas fa-user-circle"></i> Username:</label>
                <input type="text" id="editable-username" value="{{ student.username }}" readonly/>
              </div>
            </div>
          </div>
          <!-- Save Button -->
          <button class="save-button" onclick="saveProfileChanges()"><i class="fas fa-save"></i> Save Changes</button>
        </div>
      </div>
    </div>



    @app.route('/update_profile', methods=['POST'])
def update_profile():
    if 'user_username' not in session:
        return jsonify({"success": False, "message": "You need to login first"}), 401

    try:
        data = request.form.get('data')
        if not data:
            return jsonify({"success": False, "message": "No data provided"}), 400

        data = json.loads(data)
        username = session['user_username']

        update_record('students', username=data['username'], firstname=data['firstname'], lastname=data['lastname'], midname=data['midname'], course=data['course'], year_level=data['year_level'], email=data['email'])

        if 'profile_picture' in request.files:
            file = request.files['profile_picture']
            if file.filename != '':
                filename = f"student_{username}.png"
                file.save(os.path.join(app.config['UPLOAD_FOLDER'], filename))
                update_record('students', username=username, profile_picture=filename)

        return jsonify({"success": True, "message": "Profile updated successfully"})

    except Exception as e:
        return jsonify({"success": False, "message": str(e)}), 500



function saveProfileChanges() {
  const updatedData = {
    firstname: document.getElementById('editable-firstname').value,
    lastname: document.getElementById('editable-lastname').value,
    midname: document.getElementById('editable-midname').value, // Ensure this line is present
    course: document.getElementById('editable-course').value,
    year_level: document.getElementById('editable-year-level').value,
    email: document.getElementById('editable-email').value,
    username: document.getElementById('editable-username').value
  };

  const formData = new FormData();
  formData.append('data', JSON.stringify(updatedData));
  const profilePictureFile = document.getElementById('profile-picture-upload').files[0];
  if (profilePictureFile) {
    formData.append('profile_picture', profilePictureFile);
  }

  fetch('/update_profile', {
    method: 'POST',
    body: formData
  })
    .then(response => {
      if (!response.ok) {
        throw new Error('Network response was not ok');
      }
      return response.json();
    })
    .then(data => {
      if (data.success) {
        alert('Profile updated successfully!');
        window.location.reload(); // Refresh the page to reflect changes
      } else {
        alert('Failed to update profile: ' + data.message);
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('An error occurred while updating the profile.');
    });
}